{% extends 'base.html' %}
{% block title %}Your Cart{% endblock %}
{% block body %}
<div class="container my-5">
  <h2 class="mb-4">ðŸ›’ Your Cart</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  {% if products %}
    <table class="table table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Price (BDT)</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for item in products %}
        <tr>
          <td>{{ item.product.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.product.price }}</td>
          <td>{{ item.subtotal }}</td>
          <td><a href="{% url 'remove_from_cart' item.product.id %}" class="btn btn-danger btn-sm">Remove</a></td>
        </tr>
        {% endfor %}
        <tr>
          <td colspan="3" class="text-end fw-bold">Total</td>
          <td colspan="2" class="fw-bold">{{ total }}</td>
        </tr>
      </tbody>
    </table>

    <h4 class="mt-5">ðŸ§¾ Confirm Your Order</h4>
    <form method="POST" action="{% url 'confirm_order' %}" class="row g-3">
      {% csrf_token %}
      
      <!-- Full Name Field -->
      <div class="col-md-6">
        {{ form.customer_name.label_tag }}
        {{ form.customer_name }}
        {% for error in form.customer_name.errors %}
          <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Phone Field -->
      <div class="col-md-6">
        {{ form.phone.label_tag }}
        {{ form.phone }}
        {% for error in form.phone.errors %}
          <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Address Field -->
      <div class="col-12">
        {{ form.address.label_tag }}
        {{ form.address }}
        {% for error in form.address.errors %}
          <div class="text-danger small mt-1">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-12">
        <button type="submit" class="btn btn-success w-100">Confirm Order</button>
      </div>
    </form>
  {% else %}
    <div class="alert alert-warning mt-4">Your cart is empty.</div>
  {% endif %}
</div>
{% endblock %}
